var tinymce_jmy_plugin_loaded = false;
var playlist = '';
tinymce.PluginManager.requireLangPack("jmybutton");
tinymce.PluginManager.add('jmybutton', function(editor, url) {
    editor.on('init', function() {

    	if (!tinymce_jmy_plugin_loaded) {
    		tinymce_jmy_plugin_loaded = true;
	        var cssURL = url + '/jmybutton.css';
			var cssURL = url + '/css/font-awesome.css';			 
	        if(document.createStyleSheet){
	            document.createStyleSheet(cssURL);
	        } else {
	            cssLink = editor.dom.create('link', {
	                        rel: 'stylesheet',
	                        href: cssURL
	                      });
	            document.getElementsByTagName('head')[0].
	                      appendChild(cssLink);
	        }
	    }
    });

	editor.addButton('dleemo', {
		title : 'Add emoticons',
		icon : 'emoticons',
		onclick : function() {
			editor.windowManager.open({
			    title: "Add emoticons",
			    url: editor.settings.dle_root + 'engine/editor/jscripts/tiny_mce/plugins/emoticons/emotions.php',
			    width: 360,
			    height: 310
			});
		}
    });
	
	editor.addMenuItem('jmymail', {
		text : tinymce.util.I18n.translate('Insert mail'),
		icon : 'icon fa fa-envelope-o',
		context: 'insert',
		onclick : function() {
            editor.windowManager.open({
                title: tinymce.util.I18n.translate('Insert mail adress'),
                body: [{
                    type: 'textbox',
                    name:  'mail',
                    label: tinymce.util.I18n.translate('Input mail'),
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[email=' +e.data.mail +']' + editor.selection.getContent() +'[/email]');
                }
            });
		}
    });
	
	editor.addButton('jmymail', {
		title : tinymce.util.I18n.translate('Insert mail'),
		icon : 'icon fa fa-envelope-o',
		onclick : function() {
            editor.windowManager.open({
                title: tinymce.util.I18n.translate('Insert mail adress'),
                body: [{
                    type: 'textbox',
                    name:  'mail',
                    label: tinymce.util.I18n.translate('Input mail'),
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[email=' +e.data.mail +']' + editor.selection.getContent() +'[/email]');
                }
            });
		}
    });
	

	editor.addButton('jmyspoiler', {
		title : tinymce.util.I18n.translate('Insert spoiler'),
		icon : 'icon fa fa-plus-circle',
		onclick : function() {
            editor.windowManager.open({
                title: tinymce.util.I18n.translate('Insert spoiler'),
                body: [{
                    type: 'textbox',
                    name:  'title',
                    label: 'Title',
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[spoiler=' +e.data.title +']' + editor.selection.getContent() +'[/spoiler]');
                }
            });
		}
    });
	
	editor.addButton('jmymusic', {
		title : tinymce.util.I18n.translate('Insert audio'),
		icon : 'icon fa fa-music',
		onclick : function() {
            editor.windowManager.open({
                title: tinymce.util.I18n.translate('Insert audio'),
                body: [{
                    type: 'filepicker',
                    name:  'scr',                   
					label: "Source",
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[audio]' +e.data.scr + '[/audio]');
                }
            });
		}
    });
	
	editor.addButton('jmyvideo', {
		title : tinymce.util.I18n.translate('Insert video'),
		icon : 'icon fa fa-youtube-play',
		onclick : function() {
            editor.windowManager.open({
                title: tinymce.util.I18n.translate('Insert video'),
                body: [{
                    type: 'filepicker',
                    name:  'scr',                   
					label: "Source",
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[video]' +e.data.scr + '[/video]');
                }
            });
		}
    });

	editor.addMenuItem('jmyquote', {
		text: tinymce.util.I18n.translate('Insert quote'),
		icon : 'icon fa fa-quote-right',
		context: 'insert',
		onclick: function() {
			editor.execCommand('mceReplaceContent',false,'[quote]' + editor.selection.getContent() + '[/quote]');
		}
	});
	editor.addButton('jmyquote', {
		title: tinymce.util.I18n.translate('Insert quote'),
		icon : 'icon fa fa-quote-right',			
		onclick: function() {
			editor.execCommand('mceReplaceContent',false,'[quote]' + editor.selection.getContent() + '[/quote]');
		}
	});
	editor.addMenuItem('jmyhide', {
		text: tinymce.util.I18n.translate('Insert hidden text'),
		icon : 'icon fa fa-lock',
		context: 'insert',
		onclick: function() {
			editor.execCommand('mceReplaceContent',false,'[hide]' + editor.selection.getContent() + '[/hide]');
		}
	});
	editor.addButton('jmyhide', {
		title: tinymce.util.I18n.translate('Insert hidden text'),
		icon : 'icon fa fa-lock',
			
		onclick: function() {
			editor.execCommand('mceReplaceContent',false,'[hide]' + editor.selection.getContent() + '[/hide]');
		}
	});
	
	editor.addMenuItem('dlemp', {
		text: 'Insert video (BB Codes)',
		icon : 'dleicon icon-video',
		context: 'insert',
		onclick: function() {
			editor.windowManager.open({
                title: 'Insert video (BB Codes)',
                body: [{
                    type: 'textbox',
                    name: 'href',
                    label: 'Url',
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[video=' +e.data.href +']');
                }
            });
		}
	});
	editor.addButton('dlemp', {
		title : 'Insert video (BB Codes)',
		icon : 'dleicon icon-video',
		onclick : function() {
			var win = editor.windowManager.open({
                title: 'Insert video (BB Codes)',
                body: [{
                    type: 'textbox',
                    name: 'href',
                    label: 'Url',
                    size: 40,
                    value: ''
                },
				{type: 'textbox', 
				    name: 'descr', 
				    label: 'Description', 
				    value: ''
				},
				{type: 'textbox', 
				    name: 'poster', 
				    label: 'Link to poster', 
				    value: ''
				}
                ],
                buttons: [{
                    text: 'Insert',
					classes: 'widget btn primary first abs-layout-item',
					onclick: function(e) {
							win.submit();
						}
					}, {
                    text: 'Add to Playlist',
					classes: 'widget btn primary first abs-layout-item',
					onclick: function(e) {

								var videourl = win.find('#href').value();
								var videoposter = win.find('#poster').value();
								var videodescr = win.find('#descr').value();
								
								var videolink = videourl;

								if (videoposter != "" || videodescr != "" ) { 
									videolink += '|' + videoposter;
								}
								
								if (videodescr != "" ) { 
									videolink += '|' + videodescr;
								}
								
								if (videolink != "") {
									playlist +=  videolink + ',';
								}
								
								win.find('#href').value('');
								win.find('#descr').value('');
								win.find('#poster').value('');

							}
					}, {
					text: 'Close',
					onclick: 'close',
					}],
                onsubmit: function(e) {

					var videolink = win.find('#href').value();
					var poster = win.find('#poster').value();
					var descr = win.find('#descr').value();

					if (poster != "" || descr != "" ) { 
						videolink += '|' + poster;
					}
					
					if (descr != "" ) { 
						videolink += '|' + descr;
					}
					
					if(videolink != "" && videolink != "http://") {
						playlist += videolink;
					}else if(playlist != "") {
						playlist = playlist.substring(0, playlist.length - 1)
					}

					if(playlist != "") {
                   		editor.insertContent('[video=' + playlist +']');
                   	}

					playlist = '';
                }
            });
		}
    });
	editor.addMenuItem('dlaudio', {
		text: 'Insert audio (BB Codes)',
		icon : 'dleicon icon-audio',
		context: 'insert',
		onclick: function() {
			editor.windowManager.open({
                title: 'Insert audio (BB Codes)',
                body: [{
                    type: 'textbox',
                    name: 'href',
                    label: 'Url',
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[audio=' +e.data.href +']');
                }
            });
		}
	});
	editor.addButton('dlaudio', {
		title : 'Insert audio (BB Codes)',
		icon : 'dleicon icon-audio',
		onclick : function() {
			var win = editor.windowManager.open({
                title: 'Insert audio (BB Codes)',
                body: [{
                    type: 'textbox',
                    name: 'href',
                    label: 'Url',
                    size: 40,
                    value: ''
                },
				{type: 'textbox', 
				    name: 'descr', 
				    label: 'Description', 
				    value: ''
				}
                ],
                buttons: [{
                    text: 'Insert',
					classes: 'widget btn primary first abs-layout-item',
					onclick: function(e) {
							win.submit();
						}
					}, {
                    text: 'Add to Playlist',
					classes: 'widget btn primary first abs-layout-item',
					onclick: function(e) {

								var videourl = win.find('#href').value();
								var videodescr = win.find('#descr').value();
								
								var videolink = videourl;
								
								if (videodescr != "" ) { 
									videolink += '|' + videodescr;
								}
								
								if (videolink != "") {
									playlist +=  videolink + ',';
								}
								
								win.find('#href').value('');
								win.find('#descr').value('');

							}
					}, {
					text: 'Close',
					onclick: 'close',
					}],
                onsubmit: function(e) {

					var videolink = win.find('#href').value();
					var descr = win.find('#descr').value();
					
					if (descr != "" ) { 
						videolink += '|' + descr;
					}
					
					if(videolink != "") {
						playlist += videolink;
					}else if(playlist != "") {
						playlist = playlist.substring(0, playlist.length - 1);
					}

					if(playlist != "") {
                   		editor.insertContent('[audio=' + playlist +']');
                   	}

					playlist = '';
                }
            });
		}
    });
	editor.addMenuItem('dletube', {
		text: 'Play video from youtube (Youtube)',
		icon : 'dleicon icon-yt',
		context: 'insert',
		onclick: function() {
			editor.windowManager.open({
                title: 'Play video from youtube (Youtube)',
                body: [{
                    type: 'textbox',
                    name: 'href',
                    label: 'Url',
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[media=' +e.data.href +']');
                }
            });
		}
	});	
	editor.addButton('dletube', {
		title : 'Play video from youtube (Youtube)',
		icon : 'dleicon icon-yt',
		onclick : function() {
			editor.windowManager.open({
                title: 'Play video from youtube (Youtube)',
                body: [{
                    type: 'textbox',
                    name: 'href',
                    label: 'Url',
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[media=' +e.data.href +']');
                }
            });
		}
    });
	editor.addMenuItem('dlespoiler', {
		text: 'Insert spoiler',
		icon : 'dleicon icon-spoiler',
		context: 'insert',
		onclick: function() {
			editor.execCommand('mceReplaceContent',false,'[spoiler]' + editor.selection.getContent() + '[/spoiler]');
		}
	});	
	editor.addButton('dlespoiler', {
		title : 'Insert spoiler',
		icon : 'dleicon icon-spoiler',
		onclick : function() {
			editor.execCommand('mceReplaceContent',false,'[spoiler]' + editor.selection.getContent() + '[/spoiler]');
		}
    });		
	editor.addMenuItem('dlebreak', {
		text: 'Insert page breaks',
		icon : 'dleicon icon-br',
		context: 'tools',
		onclick: function() {
			editor.execCommand('mceInsertContent',false,'{PAGEBREAK}');
		}
	});
	editor.addButton('dlebreak', {
		title : 'Insert page breaks',
		icon : 'dleicon icon-br',
		onclick : function() {
			editor.execCommand('mceInsertContent',false,'{PAGEBREAK}');
		}
    });	
	editor.addMenuItem('dlepage', {
		text: 'Insert link to the page',
		icon : 'dleicon icon-pl',
		context: 'tools',
		onclick: function() {
			editor.windowManager.open({
                title: 'Insert link to the page',
                body: [{
                    type: 'textbox',
                    name: 'href',
                    label: 'Page Number',
                    size: 10,
                    value: '1'
                }, {
                    type: 'textbox',
                    name: 'text',
                    label: 'Text to display',
                    size: 40,
                    value: editor.selection.getContent({ format: 'text' })
                }],
                onsubmit: function(e) {
                   editor.insertContent('[page=' +e.data.href +']' + e.data.text +'[/page]');
                }
            });

		}
	});
	editor.addButton('dlepage', {
		title : 'Insert link to the page',
		icon : 'dleicon icon-pl',
		onclick : function() {
			editor.windowManager.open({
                title: 'Insert link to the page',
                body: [{
                    type: 'textbox',
                    name: 'href',
                    label: 'Page Number',
                    size: 10,
                    value: '1'
                }, {
                    type: 'textbox',
                    name: 'text',
                    label: 'Text to display',
                    size: 40,
                    value: editor.selection.getContent({ format: 'text' })
                }],
                onsubmit: function(e) {
                   editor.insertContent('[page=' +e.data.href +']' + e.data.text +'[/page]');
                }
            });
		}
    });

});