var tinymce_jmy_plugin_loaded = false;
var playlist = '';
tinymce.PluginManager.requireLangPack("jmybutton");
tinymce.PluginManager.add('jmybutton', function(editor, url) {
    editor.on('init', function() {

    	if (!tinymce_jmy_plugin_loaded) {
    		tinymce_jmy_plugin_loaded = true;
	        var cssURL = url + '/jmybutton.css';
			var cssURL = url + '/css/font-awesome.css';			 
	        if(document.createStyleSheet){
	            document.createStyleSheet(cssURL);
	        } else {
	            cssLink = editor.dom.create('link', {
	                        rel: 'stylesheet',
	                        href: cssURL
	                      });
	            document.getElementsByTagName('head')[0].
	                      appendChild(cssLink);
	        }
	    }
    });

	editor.addMenuItem('jmymail', {
		text : tinymce.util.I18n.translate('Insert mail'),
		icon : 'icon fa fa-envelope-o',
		context: 'insert',
		onclick : function() {
            editor.windowManager.open({
                title: tinymce.util.I18n.translate('Insert mail adress'),
                body: [{
                    type: 'textbox',
                    name:  'mail',
                    label: tinymce.util.I18n.translate('Input mail'),
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[email=' +e.data.mail +']' + editor.selection.getContent() +'[/email]');
                }
            });
		}
    });
	
	editor.addButton('jmymail', {
		title : tinymce.util.I18n.translate('Insert mail'),
		icon : 'icon fa fa-envelope-o',
		onclick : function() {
            editor.windowManager.open({
                title: tinymce.util.I18n.translate('Insert mail adress'),
                body: [{
                    type: 'textbox',
                    name:  'mail',
                    label: tinymce.util.I18n.translate('Input mail'),
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[email=' +e.data.mail +']' + editor.selection.getContent() +'[/email]');
                }
            });
		}
    });
	

	editor.addButton('jmyspoiler', {
		title : tinymce.util.I18n.translate('Insert spoiler'),
		icon : 'icon fa fa-plus-circle',
		onclick : function() {
            editor.windowManager.open({
                title: tinymce.util.I18n.translate('Insert spoiler'),
                body: [{
                    type: 'textbox',
                    name:  'title',
                    label: 'Title',
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[spoiler=' +e.data.title +']' + editor.selection.getContent() +'[/spoiler]');
                }
            });
		}
    });
	
	editor.addButton('jmymusic', {
		title : tinymce.util.I18n.translate('Insert audio'),
		icon : 'icon fa fa-music',
		onclick : function() {
            editor.windowManager.open({
                title: tinymce.util.I18n.translate('Insert audio'),
                body: [{
                    type: 'filepicker',
                    name:  'scr',                   
					label: "Source",
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[audio]' +e.data.scr + '[/audio]');
                }
            });
		}
    });
	
	editor.addButton('jmythumb', {
		title : tinymce.util.I18n.translate('Insert thumb'),
		icon : 'icon fa fa-th',
		onclick : function() {
            editor.windowManager.open({
                title: tinymce.util.I18n.translate('Insert thumb'),
                body: [{
                    type: 'filepicker',
                    name:  'scr',                   
					label: "Source",
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[thumb=center]' +e.data.scr + '[/thumb]');
                }
            });
		}
    });
	
	editor.addButton('jmyflash', {
		title : tinymce.util.I18n.translate('Insert flash'),
		icon : 'icon fa fa-flash',
		onclick : function() {
            editor.windowManager.open({
                title: tinymce.util.I18n.translate('Insert flash'),
                body: [{
                    type: 'filepicker',
                    name:  'scr',                   
					label: "Source",
                    size: 40,
                    value: ''
                }, {
					type: "container",
					label: "Dimensions",
					layout: "flex",
					direction: "row",
					align: "center",
					spacing: 5,
					items: [{
						name: "width",
						type: "textbox",
						maxLength: 5,
						size: 3,
						ariaLabel: "Width"
					}, {
						type: "label",
						text: "x"
					}, {
						name: "height",
						type: "textbox",
						maxLength: 5,
						size: 3,
						ariaLabel: "Height"
					}]
				}],
                onsubmit: function(e) {
                   editor.insertContent('[flash=' +e.data.width + 'x' +e.data.height + ']' +e.data.scr + '[/flash]');
                }
            });
		}
    });
	
	editor.addButton('jmyvideo', {
		title : tinymce.util.I18n.translate('Insert video'),
		icon : 'icon fa fa-youtube-play',
		onclick : function() {
            editor.windowManager.open({
                title: tinymce.util.I18n.translate('Insert video'),
                body: [{
                    type: 'filepicker',
                    name:  'scr',                   
					label: "Source",
                    size: 40,
                    value: ''
                }],
                onsubmit: function(e) {
                   editor.insertContent('[video]' +e.data.scr + '[/video]');
                }
            });
		}
    });

	editor.addMenuItem('jmyquote', {
		text: tinymce.util.I18n.translate('Insert quote'),
		icon : 'icon fa fa-quote-right',
		context: 'insert',
		onclick: function() {
			editor.execCommand('mceReplaceContent',false,'[quote]' + editor.selection.getContent() + '[/quote]');
		}
	});
	editor.addButton('jmyquote', {
		title: tinymce.util.I18n.translate('Insert quote'),
		icon : 'icon fa fa-quote-right',			
		onclick: function() {
			editor.execCommand('mceReplaceContent',false,'[quote]' + editor.selection.getContent() + '[/quote]');
		}
	});
	editor.addMenuItem('jmyhide', {
		text: tinymce.util.I18n.translate('Insert hidden text'),
		icon : 'icon fa fa-lock',
		context: 'insert',
		onclick: function() {
			editor.execCommand('mceReplaceContent',false,'[hide]' + editor.selection.getContent() + '[/hide]');
		}
	});
	editor.addButton('jmyhide', {
		title: tinymce.util.I18n.translate('Insert hidden text'),
		icon : 'icon fa fa-lock',
			
		onclick: function() {
			editor.execCommand('mceReplaceContent',false,'[hide]' + editor.selection.getContent() + '[/hide]');
		}
	});
});